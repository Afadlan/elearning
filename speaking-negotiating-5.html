<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1" name="viewport" />
  <title>IELTS Speaking - Negotiating Practice</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
    rel="stylesheet"
  />
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: "Roboto", sans-serif;
      perspective: 1000px;
      background-color: #f0f7ff;
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    /* 3D Card container */
    .card {
      transition: transform 0.2s ease, box-shadow 0.3s ease;
      will-change: transform;
      transform-style: preserve-3d;
      border-radius: 1rem;
      cursor: grab;
      background: white;
      box-shadow: 0 8px 15px rgba(59, 130, 246, 0.1);
      user-select: none;
      -webkit-tap-highlight-color: transparent;
      padding: 1.5rem;
    }
    .card:active {
      cursor: grabbing;
    }
    .card:hover {
      box-shadow: 0 20px 40px rgba(59, 130, 246, 0.3);
    }
    /* Button 3D style */
    .btn-animate {
      position: relative;
      overflow: hidden;
      transition: background-color 0.3s ease, color 0.3s ease, box-shadow 0.3s ease;
      z-index: 10;
      border-radius: 0.375rem;
      box-shadow: 0 6px 0 #1e40af;
      transform-style: preserve-3d;
      transform-origin: center bottom;
      background-color: #3b82f6;
      color: white;
      font-weight: 600;
      padding: 0.75rem 1.25rem;
      font-size: 0.875rem;
      user-select: none;
      cursor: pointer;
    }
    .btn-animate::before {
      content: "";
      position: absolute;
      top: 50%;
      left: 50%;
      width: 300%;
      height: 300%;
      background: rgba(59, 130, 246, 0.3);
      border-radius: 50%;
      transform: translate(-50%, -50%) scale(0);
      transition: transform 0.5s ease;
      z-index: 0;
    }
    .btn-animate:hover::before {
      transform: translate(-50%, -50%) scale(1);
    }
    .btn-animate:hover {
      background-color: #2563eb;
      box-shadow: 0 12px 0 #1e40af;
      transform: translateY(-4px) rotateX(10deg);
      color: white;
      z-index: 11;
    }
    .btn-animate:active {
      box-shadow: 0 3px 0 #1e40af;
      transform: translateY(-1px) rotateX(5deg);
    }
    /* Speaking interface styling */
    .speaking-interface {
      background: #f8fafc;
      border: 2px solid #e2e8f0;
      border-radius: 0.75rem;
      padding: 1.5rem;
      margin: 1rem 0;
      text-align: center;
    }
    .microphone-button {
      background: #dc2626;
      color: white;
      border: none;
      border-radius: 50%;
      width: 4rem;
      height: 4rem;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 1.5rem;
      margin: 0 auto 1rem;
      box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
    }
    .microphone-button:hover {
      background: #b91c1c;
      transform: scale(1.05);
      box-shadow: 0 6px 16px rgba(220, 38, 38, 0.4);
    }
    .microphone-button.recording {
      background: #ef4444;
      animation: pulse 1.5s infinite;
    }
    .microphone-button.processing {
      background: #f59e0b;
      animation: spin 1s linear infinite;
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    .recording-status {
      font-size: 0.875rem;
      color: #64748b;
      margin-bottom: 1rem;
    }
    .transcript-display {
      background: white;
      border: 1px solid #d1d5db;
      border-radius: 0.5rem;
      padding: 1rem;
      margin: 1rem 0;
      min-height: 3rem;
      text-align: left;
      font-size: 0.875rem;
      color: #374151;
    }
    .feedback-section {
      background: #f0f9ff;
      border: 1px solid #0ea5e9;
      border-radius: 0.5rem;
      padding: 1rem;
      margin: 1rem 0;
      text-align: left;
    }
    .score-display {
      display: flex;
      justify-content: space-around;
      margin: 1rem 0;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    .score-item {
      background: white;
      border: 1px solid #d1d5db;
      border-radius: 0.5rem;
      padding: 0.75rem;
      text-align: center;
      flex: 1;
      min-width: 120px;
    }
    .score-value {
      font-size: 1.25rem;
      font-weight: 700;
      color: #059669;
    }
    .score-label {
      font-size: 0.75rem;
      color: #64748b;
      margin-top: 0.25rem;
    }
    /* Logo behind text container */
    header {
      position: relative;
      z-index: 10;
      padding: 1.5rem 1.5rem 1.5rem 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      max-width: 90rem;
      margin: 0 auto;
    }
    header .bg-logo {
      position: absolute;
      top: 0;
      right: 0;
      width: 200px;
      height: 200px;
      object-fit: contain;
      border-radius: 9999px;
      opacity: 0.15;
      z-index: 0;
      pointer-events: none;
    }
    @media (max-width: 768px) {
      header .bg-logo {
        width: 120px;
        height: 120px;
        opacity: 0.1;
      }
    }
    @media (max-width: 480px) {
      header .bg-logo {
        width: 80px;
        height: 80px;
        opacity: 0.08;
      }
    }
    .font-golden {
      font-weight: 700;
      color: #2563eb;
      font-size: 1.125rem;
      user-select: none;
    }
    /* Scrollbar hidden for main content */
    main::-webkit-scrollbar {
      display: none;
    }
    main {
      -ms-overflow-style: none;
      scrollbar-width: none;
      position: relative;
      padding-bottom: 5rem;
    }
    /* Inner card for conversation text */
    .inner-card {
      border: 1px solid #334155;
      border-radius: 0.5rem;
      padding: 1rem;
      font-size: 0.75rem;
      color: #1e293b;
      line-height: 1.3;
      margin-bottom: 1.5rem;
      background: white;
      user-select: text;
    }
    .inner-card p {
      margin-bottom: 0.5rem;
    }
    .inner-card p strong {
      font-weight: 700;
    }
    /* Progress bar styling */
    progress {
      -webkit-appearance: none;
      appearance: none;
      width: 100%;
      height: 0.25rem;
      border-radius: 9999px;
      overflow: hidden;
      margin-top: 0.25rem;
      margin-bottom: 0.5rem;
    }
    progress::-webkit-progress-bar {
      background-color: #cbd5e1;
    }
    progress::-webkit-progress-value {
      background-color: #2563eb;
      transition: width 1s linear;
    }
    progress::-moz-progress-bar {
      background-color: #2563eb;
      transition: width 1s linear;
    }
    /* Fixed next button bottom right */
    .next-button-container {
      position: fixed;
      bottom: 1.5rem;
      right: 1.5rem;
      z-index: 20;
    }
    @media (max-width: 640px) {
      .next-button-container {
        position: static;
        margin-top: 1rem;
        display: flex;
        justify-content: flex-end;
        padding-right: 1.5rem;
      }
      main {
        padding-bottom: 1rem;
      }
    }
  </style>
</head>
<body>
  <header>
    <img
      alt="ReallyEnglish logo with letters R and E in blue square"
      class="relative z-10"
      height="40"
      src="https://storage.googleapis.com/a1aa/image/d09cce8d-911a-405c-e6b3-63ef1c89ae3a.jpg"
      width="40"
      decoding="async"
      loading="lazy"
    />
    <span class="font-golden select-none">ReallyEnglish</span>
    <img
      alt="Large blue gradient circle shape behind header text"
      class="bg-logo"
      height="200"
      src="https://storage.googleapis.com/a1aa/image/7a536139-0f90-464f-5576-28fa91748278.jpg"
      width="200"
      decoding="async"
      loading="lazy"
    />
  </header>
  <main class="max-w-4xl mx-auto px-6 py-8 flex-grow">
    <section class="mb-6">
      <div
        class="bg-[#2563eb] text-white text-[10px] text-center py-1 rounded-md select-none font-semibold"
        aria-label="IELTS Speaking test title"
      >
        IELTS Speaking Practice - Negotiating Skills (B1 Level)
      </div>
      <progress
        id="progressBar"
        max="100"
        value="90"
        aria-label="Speaking test progress bar"
        role="progressbar"
        aria-valuemin="0"
        aria-valuemax="100"
        aria-valuenow="90"
      ></progress>
      <p
        class="text-[10px] text-center text-black/80 select-none leading-tight"
        aria-live="polite"
        aria-atomic="true"
        id="countdownText"
      >
        Questions 9-10 of 10<br />
        <span id="timeDisplay">Final Negotiating Practice</span>
      </p>
    </section>
    <section
      class="card rounded-xl"
      aria-label="Speaking Assessment - Negotiating section"
      id="mainCard"
    >
      <div class="inner-card" aria-live="polite" aria-atomic="true">
        <p class="font-bold text-center mb-1">
          IELTS Speaking - Negotiating Skills (B1)
        </p>
        <p class="text-center mb-3">
          Final negotiation challenges. Demonstrate mastery of diplomatic language and creative problem-solving.
        </p>
        <p class="font-bold mb-3">Part 5: Master Level Negotiations</p>
        
        <div class="speaking-interface">
          <p class="text-sm font-semibold mb-2">üé§ Speaking Task 9 - Read Aloud</p>
          <p class="text-sm mb-4"><strong>Instructions:</strong> Read the following complex negotiation scenario. Show mastery of persuasive and diplomatic language.</p>
          <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4 text-left">
            <p class="text-sm font-semibold mb-2">Multi-Party Stakeholder Negotiation</p>
            <p class="text-sm leading-relaxed">
              "Ladies and gentlemen, thank you all for joining this crucial meeting. As we know, we have three different stakeholder groups with seemingly conflicting interests regarding the new development project. The local community is concerned about environmental impact and traffic congestion. The investors are focused on maximizing returns and minimizing delays. The city council needs to balance economic development with public welfare. I believe we can find a solution that addresses everyone's core concerns. What if we propose a phased development approach? Phase one would include enhanced environmental protections and improved public transportation infrastructure, addressing community concerns. Phase two would focus on the main commercial development, satisfying investor requirements. This timeline would allow the city council to monitor progress and ensure compliance with all regulations. Additionally, we could establish a community benefit fund from a percentage of profits, creating long-term value for residents. Would this framework provide a foundation for further discussion?"
            </p>
          </div>
          <p class="text-xs text-blue-600 mb-4"><em>Show leadership in complex negotiations. Balance multiple perspectives and propose creative solutions.</em></p>
          
          <button id="micButton9" class="microphone-button" onclick="toggleRecording(9)">
            <i class="fas fa-microphone"></i>
          </button>
          
          <div id="recordingStatus9" class="recording-status">
            Click the microphone to start recording
          </div>
          
          <div id="transcript9" class="transcript-display">
            Your speech will appear here as you speak...
          </div>
          
          <div id="feedback9" class="feedback-section" style="display: none;">
            <h4 class="font-semibold mb-2">üìä Analysis Results</h4>
            <div class="score-display">
              <div class="score-item">
                <div id="grammarScore9" class="score-value">--</div>
                <div class="score-label">Grammar</div>
              </div>
              <div class="score-item">
                <div id="pronunciationScore9" class="score-value">--</div>
                <div class="score-label">Pronunciation</div>
              </div>
              <div class="score-item">
                <div id="fluencyScore9" class="score-value">--</div>
                <div class="score-label">Fluency</div>
              </div>
              <div class="score-item">
                <div id="coherenceScore9" class="score-value">--</div>
                <div class="score-label">Coherence</div>
              </div>
            </div>
            <div id="detailedFeedback9" class="mt-3 text-sm">
              <!-- Detailed feedback will appear here -->
            </div>
          </div>
        </div>
      </div>
    </section>
    
    <section
      class="card rounded-xl mt-6"
      aria-label="Speaking Task 10"
      id="task10Card"
    >
      <div class="inner-card">
        <div class="speaking-interface">
          <p class="text-sm font-semibold mb-2">üé§ Speaking Task 10 - Read Aloud</p>
          <p class="text-sm mb-4"><strong>Instructions:</strong> Read the following crisis negotiation dialogue. Show calm leadership and decisive problem-solving.</p>
          <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4 text-left">
            <p class="text-sm font-semibold mb-2">Crisis Management Negotiation</p>
            <p class="text-sm leading-relaxed mb-2">
              <strong>Crisis Manager:</strong> "I understand everyone is under tremendous pressure right now. We have a situation that requires immediate attention, but we need to make decisions carefully to avoid making things worse."
            </p>
            <p class="text-sm leading-relaxed mb-2">
              <strong>Operations Team:</strong> "We need to shut down the entire system immediately. It's the only way to prevent further damage."
            </p>
            <p class="text-sm leading-relaxed mb-2">
              <strong>Sales Team:</strong> "If we shut down now, we'll lose millions in revenue and damage our reputation with clients. There has to be another way."
            </p>
            <p class="text-sm leading-relaxed">
              <strong>Crisis Manager:</strong> "I hear both concerns, and they're both valid. Let's find a middle ground. What if we implement a partial shutdown? We can isolate the affected systems while keeping critical services running for our most important clients. This would minimize revenue loss while we address the technical issues. We can also prepare a transparent communication to clients explaining the situation and our proactive measures. Operations team, can you identify which systems are absolutely critical to isolate? Sales team, can you prioritize our top-tier clients for continued service? We have thirty minutes to implement this plan. Let's work together to protect both our systems and our business relationships."
            </p>
          </div>
          <p class="text-xs text-blue-600 mb-4"><em>Show calm authority under pressure. Demonstrate decisive leadership while considering all stakeholders.</em></p>
          
          <button id="micButton10" class="microphone-button" onclick="toggleRecording(10)">
            <i class="fas fa-microphone"></i>
          </button>
          
          <div id="recordingStatus10" class="recording-status">
            Click the microphone to start recording
          </div>
          
          <div id="transcript10" class="transcript-display">
            Your speech will appear here as you speak...
          </div>
          
          <div id="feedback10" class="feedback-section" style="display: none;">
            <h4 class="font-semibold mb-2">üìä Analysis Results</h4>
            <div class="score-display">
              <div class="score-item">
                <div id="grammarScore10" class="score-value">--</div>
                <div class="score-label">Grammar</div>
              </div>
              <div class="score-item">
                <div id="pronunciationScore10" class="score-value">--</div>
                <div class="score-label">Pronunciation</div>
              </div>
              <div class="score-item">
                <div id="fluencyScore10" class="score-value">--</div>
                <div class="score-label">Fluency</div>
              </div>
              <div class="score-item">
                <div id="coherenceScore10" class="score-value">--</div>
                <div class="score-label">Coherence</div>
              </div>
            </div>
            <div id="detailedFeedback10" class="mt-3 text-sm">
              <!-- Detailed feedback will appear here -->
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>
  <div class="next-button-container">
    <a href="speaking-issues-options-1.html" class="btn-animate inline-block text-center" aria-label="Next theme: Issues and Options">
      Next Theme
    </a>
  </div>
  <script>
    // Speech recognition and recording functionality
    let mediaRecorder = {};
    let audioChunks = {};
    let isRecording = {};
    let recognition = {};
    let recordingTimeout = {};
    let recordingStartTime = {};
    
    // Initialize speech recognition if available
    function initializeSpeechRecognition(taskId) {
      if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        recognition[taskId] = new SpeechRecognition();
        recognition[taskId].continuous = true;
        recognition[taskId].interimResults = true;
        recognition[taskId].lang = 'en-US';
        
        recognition[taskId].onresult = function(event) {
          let transcript = '';
          for (let i = event.resultIndex; i < event.results.length; i++) {
            transcript += event.results[i][0].transcript;
          }
          document.getElementById(`transcript${taskId}`).textContent = transcript;
        };
        
        recognition[taskId].onerror = function(event) {
          console.error('Speech recognition error:', event.error);
          document.getElementById(`recordingStatus${taskId}`).textContent = 'Speech recognition error. Please try again.';
        };
        
        recognition[taskId].onend = function() {
          if (isRecording[taskId]) {
            recognition[taskId].start();
          }
        };
      }
    }
    
    // Initialize speech recognition for both tasks
    initializeSpeechRecognition(9);
    initializeSpeechRecognition(10);
    
    async function toggleRecording(taskId) {
      const micButton = document.getElementById(`micButton${taskId}`);
      const recordingStatus = document.getElementById(`recordingStatus${taskId}`);
      const transcript = document.getElementById(`transcript${taskId}`);
      const feedback = document.getElementById(`feedback${taskId}`);
      
      if (!isRecording[taskId]) {
        try {
          const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
          
          mediaRecorder[taskId] = new MediaRecorder(stream);
          audioChunks[taskId] = [];
          isRecording[taskId] = true;
          recordingStartTime[taskId] = Date.now();
          
          micButton.classList.add('recording');
          micButton.innerHTML = '<i class="fas fa-stop"></i>';
          recordingStatus.textContent = 'Recording... Click to stop';
          transcript.textContent = 'Listening...';
          feedback.style.display = 'none';
          
          if (recognition[taskId]) {
            recognition[taskId].start();
          }
          
          mediaRecorder[taskId].ondataavailable = function(event) {
            audioChunks[taskId].push(event.data);
          };
          
          mediaRecorder[taskId].onstop = function() {
            const audioBlob = new Blob(audioChunks[taskId], { type: 'audio/wav' });
            const recordingDuration = (Date.now() - recordingStartTime[taskId]) / 1000;
            processRecording(taskId, audioBlob, recordingDuration);
          };
          
          mediaRecorder[taskId].start();
          
          recordingTimeout[taskId] = setTimeout(() => {
            if (isRecording[taskId]) {
              toggleRecording(taskId);
            }
          }, 180000);
          
        } catch (error) {
          console.error('Error accessing microphone:', error);
          recordingStatus.textContent = 'Error accessing microphone. Please check permissions.';
        }
      } else {
        isRecording[taskId] = false;
        
        if (mediaRecorder[taskId] && mediaRecorder[taskId].state !== 'inactive') {
          mediaRecorder[taskId].stop();
        }
        
        if (recognition[taskId]) {
          recognition[taskId].stop();
        }
        
        if (recordingTimeout[taskId]) {
          clearTimeout(recordingTimeout[taskId]);
        }
        
        micButton.classList.remove('recording');
        micButton.classList.add('processing');
        micButton.innerHTML = '<i class="fas fa-cog"></i>';
        recordingStatus.textContent = 'Processing your speech...';
        
        const stream = mediaRecorder[taskId].stream;
        if (stream) {
          stream.getTracks().forEach(track => track.stop());
        }
      }
    }
    
    function processRecording(taskId, audioBlob, duration) {
      setTimeout(() => {
        const micButton = document.getElementById(`micButton${taskId}`);
        const recordingStatus = document.getElementById(`recordingStatus${taskId}`);
        const feedback = document.getElementById(`feedback${taskId}`);
        
        micButton.classList.remove('processing');
        micButton.innerHTML = '<i class="fas fa-microphone"></i>';
        recordingStatus.textContent = 'Recording complete. Click to record again.';
        
        const scores = generateEnhancedScores(duration, taskId);
        displayFeedback(taskId, scores, duration);
        
        feedback.style.display = 'block';
      }, 2000);
    }
    
    function generateEnhancedScores(duration, taskId) {
      let baseGrammar = Math.floor(Math.random() * 3) + 5; // 5-7 for master level
      let basePronunciation = Math.floor(Math.random() * 3) + 5; // 5-7
      let baseFluency = Math.floor(Math.random() * 3) + 5; // 5-7
      let baseCoherence = Math.floor(Math.random() * 3) + 5; // 5-7
      
      // Master level expectations
      if (duration < 90) {
        const penalty = Math.floor((90 - duration) / 15);
        baseFluency = Math.max(1, baseFluency - penalty);
        baseCoherence = Math.max(1, baseCoherence - penalty);
      }
      
      if (duration > 150) {
        basePronunciation = Math.min(9, basePronunciation + 1);
        baseGrammar = Math.min(9, baseGrammar + 1);
      }
      
      return {
        grammar: baseGrammar,
        pronunciation: basePronunciation,
        fluency: baseFluency,
        coherence: baseCoherence,
        duration: duration
      };
    }
    
    function displayFeedback(taskId, scores, duration) {
      document.getElementById(`grammarScore${taskId}`).textContent = scores.grammar + '/9';
      document.getElementById(`pronunciationScore${taskId}`).textContent = scores.pronunciation + '/9';
      document.getElementById(`fluencyScore${taskId}`).textContent = scores.fluency + '/9';
      document.getElementById(`coherenceScore${taskId}`).textContent = scores.coherence + '/9';
      
      const feedbackText = generateDetailedFeedback(scores, duration);
      document.getElementById(`detailedFeedback${taskId}`).innerHTML = feedbackText;
    }
    
    function generateDetailedFeedback(scores, duration) {
      let feedback = '<strong>Master Level Negotiation Analysis:</strong><br>';
      
      if (duration < 90) {
        feedback += `‚ö†Ô∏è <strong>Duration:</strong> Too brief for master-level complexity (${Math.round(duration)}s). Develop comprehensive arguments.<br>`;
      } else if (duration > 180) {
        feedback += `‚ö†Ô∏è <strong>Duration:</strong> Too lengthy (${Math.round(duration)}s). Master concise yet comprehensive communication.<br>`;
      } else {
        feedback += `‚úÖ <strong>Duration:</strong> Excellent length for complex negotiation (${Math.round(duration)}s).<br>`;
      }
      
      if (scores.pronunciation >= 6) {
        feedback += '‚úÖ <strong>Pronunciation:</strong> Masterful delivery with authoritative presence.<br>';
      } else {
        feedback += '‚ö†Ô∏è <strong>Pronunciation:</strong> Work on executive-level pronunciation and gravitas.<br>';
      }
      
      if (scores.fluency >= 6) {
        feedback += '‚úÖ <strong>Fluency:</strong> Confident leadership communication under pressure.<br>';
      } else {
        feedback += '‚ö†Ô∏è <strong>Fluency:</strong> Practice high-stakes scenarios for smoother crisis communication.<br>';
      }
      
      if (scores.coherence >= 6) {
        feedback += '‚úÖ <strong>Expression:</strong> Outstanding demonstration of leadership and strategic thinking.';
      } else {
        feedback += '‚ö†Ô∏è <strong>Expression:</strong> Work on showing decisive leadership while balancing multiple stakeholder concerns.';
      }
      
      return feedback;
    }

    // 3D card tilt effect
    const cards = document.querySelectorAll(".card");
    cards.forEach((card) => {
      card.addEventListener("mousemove", (e) => {
        const rect = card.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        const centerX = rect.width / 2;
        const centerY = rect.height / 2;
        const rotateX = ((y - centerY) / centerY) * 10;
        const rotateY = ((x - centerX) / centerX) * 10;
        card.style.transform = `rotateX(${-rotateX}deg) rotateY(${rotateY}deg) scale(1.05)`;
      });
      card.addEventListener("mouseleave", () => {
        card.style.transform = "rotateX(0deg) rotateY(0deg) scale(1)";
      });
    });
  </script>
</body>
</html>
